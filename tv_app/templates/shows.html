{% extends "base.html" %}
{% block title %}Available Shows{% endblock %}
{% block content %}
    <h2><span class="show-label-icon"></span>Available TV Shows</h2>

    {# --- FILTER FORM --- #}
    <form method="GET" action="{{ url_for('list_shows') }}" class="filter-form">
        <div class="filter-group">
            <label for="genre">Genre:</label>
            <select id="genre" name="genre">
                <option value="">All Genres</option>
                {% for genre in genres %}
                    {# Using selected_genre passed from backend #}
                    <option value="{{ genre.name }}" {% if genre.name == selected_genre %}selected{% endif %}>{{ genre.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            {# --- CHANGE: Updated Label Text --- #}
            <label for="rating">Rating:</label> {# Changed from "Minimum Rating:" #}
            {# Or use: <label for="rating">Rating Range (X.x):</label> #}
            <select id="rating" name="rating">
                <option value="">All Ratings</option> {# "All Ratings" option #}
                {% for rating in ratings %} {# Iterates over static list [10, 9, ..., 0] #}
                    {# Compares integer 'rating' with integer 'selected_rating' #}
                    <option value="{{ rating }}" {% if rating == selected_rating %}selected{% endif %}>{{ rating }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            <label for="year">Year:</label>
            <select id="year" name="year">
                <option value="">All Years</option>
                {% for year in years %}
                    {# Using selected_year passed from backend #}
                    <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>{{ year }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            <label for="sort_by">Sort By:</label>
            <select id="sort_by" name="sort_by">
                 {# Using current_sort_by passed from backend for selection consistency #}
                <option value="name_asc" {% if current_sort_by == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                <option value="name_desc" {% if current_sort_by == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
                <option value="date_asc" {% if current_sort_by == 'date_asc' %}selected{% endif %}>Date (Oldest)</option>
                <option value="date_desc" {% if current_sort_by == 'date_desc' %}selected{% endif %}>Date (Newest)</option>
                <option value="rating_asc" {% if current_sort_by == 'rating_asc' %}selected{% endif %}>Rating (Lowest)</option>
                <option value="rating_desc" {% if current_sort_by == 'rating_desc' %}selected{% endif %}>Rating (Highest)</option>
            </select>
        </div>

        <button type="submit">Filter</button>
        {# Reset link clears all query parameters #}
        <a href="{{ url_for('list_shows') }}" class="reset-button">Reset</a>
    </form>

    {# Pagination Links (TOP) #}
    {# Construct links passing current filter/sort values explicitly for robustness #}
    <div class="pagination">
        {% if shows.has_prev %}
            <a href="{{ url_for('list_shows', page=shows.prev_num, genre=selected_genre, rating=selected_rating, year=selected_year, sort_by=current_sort_by) }}">Previous</a>
        {% else %}
            <span class="disabled">Previous</span>
        {% endif %}

        {% for page_num in shows.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if shows.page == page_num %}
                    <span class="current-page">{{ page_num }}</span>
                {% else %}
                     <a href="{{ url_for('list_shows', page=page_num, genre=selected_genre, rating=selected_rating, year=selected_year, sort_by=current_sort_by) }}">{{ page_num }}</a>
                {% endif %}
            {% else %}
                <span class="ellipsis">…</span>
            {% endif %}
        {% endfor %}

        {% if shows.has_next %}
            <a href="{{ url_for('list_shows', page=shows.next_num, genre=selected_genre, rating=selected_rating, year=selected_year, sort_by=current_sort_by) }}">Next</a>
        {% else %}
            <span class="disabled">Next</span>
        {% endif %}
    </div>

    <div class="show-list">
        {% for show in shows.items %}
             {# Consider adding rating display here if useful #}
            <a href="{{ url_for('index', search=show.show_name) }}" class="show-item">
                {{ show.show_name }} {% if show.rating %} ({{ show.rating }}) {% endif %} {# Example: show rating #}
            </a>
        {% endfor %}
        {% if not shows.items %}
            <p>No Shows found matching your criteria.</p> {# More specific message #}
        {% endif %}
    </div>

    {# Pagination Links (BOTTOM) - Identical to top #}
    <div class="pagination">
        {% if shows.has_prev %}
             <a href="{{ url_for('list_shows', page=shows.prev_num, genre=selected_genre, rating=selected_rating, year=selected_year, sort_by=current_sort_by) }}">Previous</a>
        {% else %}
            <span class="disabled">Previous</span>
        {% endif %}

        {% for page_num in shows.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if shows.page == page_num %}
                    <span class="current-page">{{ page_num }}</span>
                {% else %}
                    <a href="{{ url_for('list_shows', page=page_num, genre=selected_genre, rating=selected_rating, year=selected_year, sort_by=current_sort_by) }}">{{ page_num }}</a>
                {% endif %}
            {% else %}
                <span class="ellipsis">…</span>
            {% endif %}
        {% endfor %}

        {% if shows.has_next %}
           <a href="{{ url_for('list_shows', page=shows.next_num, genre=selected_genre, rating=selected_rating, year=selected_year, sort_by=current_sort_by) }}">Next</a>
        {% else %}
            <span class="disabled">Next</span>
        {% endif %}
    </div>
{% endblock %}

