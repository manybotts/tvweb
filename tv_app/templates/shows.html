{% extends "base.html" %}

{% block title %}Available Shows{% endblock %}

{% block content %}
<div class="shows-container">

    <h2><span class="show-label-icon"></span>Available TV Shows</h2>

    <div class="filters-container">

        <div class="sort-options">
            Sort by:
            <a href="{{ url_for('list_shows', sort='name', genre=filter_genre, year=filter_year, rating=filter_rating) }}" {% if sort_by == 'name' %}class="active-sort"{% endif %}>Name</a> |
            <a href="{{ url_for('list_shows', sort='popularity', genre=filter_genre, year=filter_year, rating=filter_rating) }}" {% if sort_by == 'popularity' %}class="active-sort"{% endif %}>Popularity</a> |
             <a href="{{ url_for('list_shows', sort='year', genre=filter_genre, year=filter_year, rating=filter_rating) }}" {% if sort_by == 'year' %}class="active-sort"{% endif %}>Year</a>
        </div>

        <div class="filter-group">
            <label for="genre-filter">Genre:</label>
            <a href="{{ url_for('list_shows', sort=sort_by, year=filter_year, rating=filter_rating) }}">All</a> |
            {% for genre in all_genres %}
              <a href="{{ url_for('list_shows', sort=sort_by, genre=genre, year=filter_year, rating=filter_rating) }}" {% if genre == filter_genre %}class="active-filter"{% endif %}>{{ genre }}</a> |
            {% endfor %}

            <form action="{{ url_for('list_shows') }}" method="GET" class="filter-form">
                <input type="hidden" name="sort" value="{{ sort_by }}">
                <input type="hidden" name="year" value="{{ filter_year }}">
                <input type="hidden" name="rating" value="{{ filter_rating }}">
                <select name="genre" id="genre-filter" onchange="this.form.submit()">
                    <option value="all" {% if filter_genre == 'all' or filter_genre == None %}selected{% endif %}>All</option>
                    {% for genre_option in all_genres %}
                        <option value="{{ genre_option }}" {% if genre_option == filter_genre %}selected{% endif %}>{{ genre_option }}</option>
                    {% endfor %}
                </select>
                 <noscript><button type="submit" class="filter-button">Filter</button></noscript>
            </form>
        </div>

        <div class="filter-group">
          <label for="year-filter">Year:</label>
            <a href="{{ url_for('list_shows', sort=sort_by, genre=filter_genre, rating=filter_rating) }}">All</a> |
             {% for year in range(now.year, now.year - 51, -1) %}
                <a href="{{ url_for('list_shows', sort=sort_by, genre=filter_genre, year=year, rating=filter_rating) }}" {% if year|string == filter_year %}class="active-sort"{% endif %}>{{ year }}</a> |
             {% endfor %}
            <form action="{{ url_for('list_shows') }}" method="GET" class="filter-form">
                <input type="hidden" name="sort" value="{{ sort_by }}">
                <input type="hidden" name="genre" value="{{ filter_genre }}">
                <input type="hidden" name="rating" value="{{ filter_rating }}">
                <select name="year" id="year-filter" onchange="this.form.submit()">
                   <option value="all" {% if filter_year == 'all' or filter_year == None %}selected{% endif %}>All</option>
                     {% for year_option in range(now.year, now.year - 51, -1) %}
                        <option value="{{ year_option }}" {% if year_option|string == filter_year %}selected{% endif %}>{{ year_option }}</option>
                    {% endfor %}
                </select>
                <noscript><button type="submit" class="filter-button">Filter</button></noscript>
            </form>
        </div>

        <div class="filter-group">
            <label for="rating-filter">Rating:</label>
            <a href="{{ url_for('list_shows', sort=sort_by, genre=filter_genre, year=filter_year) }}">All</a> |
            <a href="{{ url_for('list_shows', sort=sort_by, genre=filter_genre, year=filter_year, rating=7) }}">7+</a> |
            <a href="{{ url_for('list_shows', sort=sort_by, genre=filter_genre, year=filter_year, rating=8) }}">8+</a> |
            <a href="{{ url_for('list_shows', sort=sort_by, genre=filter_genre, year=filter_year, rating=9) }}">9+</a>
            <form action="{{ url_for('list_shows') }}" method="GET" class="filter-form">
              <input type="hidden" name="sort" value="{{ sort_by }}">
              <input type="hidden" name="genre" value="{{ filter_genre }}">
              <input type="hidden" name="year" value="{{ filter_year }}">
              <select name="rating" id="rating-filter" onchange="this.form.submit()">
                    <option value="all" {% if filter_rating == 'all' or filter_rating == None %}selected{% endif %}>All</option>
                    {% for rating_option in range(10, 0, -1) %}
                        <option value="{{ rating_option }}" {% if rating_option|string == filter_rating %} selected {% endif %}>{{ rating_option }}+</option>
                    {% endfor %}
                </select>
                <noscript><button type="submit" class="filter-button">Filter</button></noscript>
            </form>
        </div>
    </div>

  {% if shows.items %}
    <ul class="shows-list">
      {% for show in shows.items %}
        <li class="show-item">
            <a href="{{ url_for('show_details', show_id=show.id) }}" class="show-link">
                {{ show.title }}  {# Corrected field name #}
            </a>
          </li>
       {% else %}
        <p>No shows found.</p>
      {% endfor %}
    </ul>

    {% else %}
        <p>No shows found.</p>
    {% endif %}

    {# Pagination Links #}
    <div class="pagination">
        {% if shows.has_prev %}
        <a href="{{ url_for('list_shows', page=shows.prev_num, sort=sort_by, genre=filter_genre, year=filter_year, rating=filter_rating) }}">
            &laquo; Previous
        </a>
        {% else %}
        <span class="disabled">&laquo; Previous</span>
        {% endif %}

        {% for page_num in shows.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if shows.page == page_num %}
                <span class="current-page">{{ page_num }}</span>
                {% else %}
                <a href="{{ url_for('list_shows', page=page_num, sort=sort_by, genre=filter_genre, year=filter_year, rating=filter_rating) }}">
                    {{ page_num }}
                </a>
                {% endif %}
            {% else %}
                <span class="ellipsis">...</span>
            {% endif %}
        {% endfor %}

        {% if shows.has_next %}
        <a href="{{ url_for('list_shows', page=shows.next_num, sort=sort_by, genre=filter_genre, year=filter_year, rating=filter_rating) }}">
            Next &raquo;
        </a>
        {% else %}
        <span class="disabled">Next &raquo;</span>
        {% endif %}
    </div>
</div>
{% endblock %}
