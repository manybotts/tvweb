{# templates/admin.html #}
{% extends "base.html" %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
    <h1>Admin Panel</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">  {# Added class for styling #}
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <h2>Add New Show</h2>
    <form method="POST" action="{{ url_for('admin') }}">
        {{ add_show_form.hidden_tag() }}
        <div class="form-group">
            {{ add_show_form.title.label }} {{ add_show_form.title(class="form-control") }}  {# Added form-control class #}
            {% for error in add_show_form.title.errors %}
                <span class="error-message">{{ error }}</span>  {# Display validation errors #}
            {% endfor %}
        </div>
        <div class="form-group">
            {{ add_show_form.overview.label }} {{ add_show_form.overview(class="form-control") }}
            {% for error in add_show_form.overview.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>
        <div class="form-group">
           {{ add_show_form.release_year.label }} {{ add_show_form.release_year(class="form-control") }}
            {% for error in add_show_form.release_year.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>
        <div class="form-group">
            {{ add_show_form.genre.label }} {{ add_show_form.genre(class="form-control") }}
            {% for error in add_show_form.genre.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>
        <div class="form-group">
           {{ add_show_form.image_url.label }} {{ add_show_form.image_url(class="form-control") }}
            {% for error in add_show_form.image_url.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ add_show_form.trailer_url.label }} {{ add_show_form.trailer_url(class="form-control") }}
            {% for error in add_show_form.trailer_url.errors %}
               <span class="error-message">{{ error }}</span>
            {% endfor %}
         </div>

        <div class="form-group">
           {{ add_show_form.imdb_id.label }} {{ add_show_form.imdb_id(class="form-control") }}
            {% for error in add_show_form.imdb_id.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>
        <div class="form-group">
             {{ add_show_form.download_link.label }} {{ add_show_form.download_link(class="form-control") }}
            {% for error in add_show_form.download_link.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>

        <div class="form-group">
          {{ add_show_form.available_seasons.label }} {{ add_show_form.available_seasons(class="form-control") }}
            {% for error in add_show_form.available_seasons.errors %}
               <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>
        <div class="form-check">
            {{ add_show_form.is_new.label(class="form-check-label") }}
            {{ add_show_form.is_new(class="form-check-input") }}
        </div>
        <div class="form-check">
           {{ add_show_form.on_slider.label(class="form-check-label") }}
           {{ add_show_form.on_slider(class="form-check-input") }}
        </div>
         {{ add_show_form.submit_show(class="btn btn-primary") }}  {# Use a more descriptive submit button #}
    </form>

    <h2>Add New Episode</h2>
    <form method="POST" action="{{ url_for('admin') }}">
        {{ add_episode_form.hidden_tag() }}
         <div class="form-group">
            {{ add_episode_form.title.label }} {{ add_episode_form.title(class="form-control") }}
            {% for error in add_episode_form.title.errors %}
               <span class="error-message">{{ error }}</span>
            {% endfor %}
         </div>
        <div class="form-group">
            {{ add_episode_form.episode_number.label }} {{ add_episode_form.episode_number(class="form-control") }}
            {% for error in add_episode_form.episode_number.errors %}
               <span class="error-message">{{ error }}</span>
             {% endfor %}
        </div>

        <div class="form-group">
            {{ add_episode_form.season_number.label }} {{ add_episode_form.season_number(class="form-control") }}
             {% for error in add_episode_form.season_number.errors %}
                <span class="error-message">{{ error }}</span>
             {% endfor %}
        </div>
        <div class="form-group">
            {{ add_episode_form.show_id.label }} {{ add_episode_form.show_id(class="form-control") }}
            {% for error in add_episode_form.show_id.errors %}
               <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>
       <div class="form-group">
            {{ add_episode_form.download_link.label }} {{ add_episode_form.download_link(class="form-control") }}
             {% for error in add_episode_form.download_link.errors %}
                 <span class="error-message">{{ error }}</span>
              {% endfor %}
       </div>
        <div class="form-group">
           {{ add_episode_form.overview.label }} {{ add_episode_form.overview(class="form-control") }}
            {% for error in add_episode_form.overview.errors %}
                 <span class="error-message">{{ error }}</span>
            {% endfor %}
        </div>

        {{ add_episode_form.submit_episode(class="btn btn-primary") }} {# Use a more descriptive submit button #}
    </form>


    <h2>Existing Shows</h2>
    <table class="table">  {# Added table class for styling #}
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for show in shows %}
            <tr>
                <td>{{ show.id }}</td>
                <td>{{ show.title }}</td>  {# Use correct field name #}
                <td>
                    <form action="{{ url_for('delete_show', show_id=show.id) }}" method="post">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this show and all its episodes?');">Delete Show</button>  {# Added btn classes #}
                    </form>
                     <a href="{{ url_for('edit_show', show_id=show.id) }}" class="btn btn-warning">Edit Show</a>  {# Added btn classes #}

                     {% if show.on_slider %}
                       <form action="{{ url_for('remove_from_slider', show_id=show.id) }}" method="post">
                         <button type="submit"  class="btn btn-info">Remove from Slider</button>
                       </form>
                    {% else %}
                       <form action="{{ url_for('add_to_slider', show_id=show.id) }}" method="post">
                         <button type="submit" class="btn btn-info">Add to Slider</button>
                       </form>
                    {% endif %}

                    {% if show.is_new %}
                      <form action="{{ url_for('unmark_as_new', show_id=show.id) }}" method="post">
                        <button type="submit" class="btn btn-secondary">Unmark as New</button>
                      </form>
                    {% else %}
                      <form action="{{ url_for('mark_as_new', show_id=show.id) }}" method="post">
                        <button type="submit" class="btn btn-secondary">Mark as New</button>
                      </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
<h2>Existing Episodes</h2>
    <table class="table">  {# Added table class for styling #}
        <thead>
            <tr>
                <th>ID</th>
                <th>Show</th>
                <th>Season</th>
                <th>Episode</th>
                <th>Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
             {% for episode in episodes %}
            <tr>
                <td>{{ episode.id }}</td>
                <td>{{ episode.show.title }}</td>  {# Use correct field name #}
                <td>{{ episode.season_number }}</td>
                <td>{{ episode.episode_number }}</td>
                <td>{{ episode.title if episode.title else 'N/A' }}</td>
                <td>
                   <form action= "{{ url_for('delete_episode', episode_id=episode.id) }}" method="post">
                       <button type="submit" class="btn btn-danger" onclick="return confirm('Sure to delete?');">Delete Episode</button>  {# Added btn classes #}
                   </form>
                   <a href="{{ url_for('edit_episode', episode_id=episode.id) }}" class="btn btn-warning">Edit Episode</a>  {# Added btn classes #}
                </td>
            </tr>
            {% endfor %}

        </tbody>
</table>

<p><a href="{{ url_for('admin_logout') }}" class="btn btn-secondary">Logout</a></p> {# Added btn class #}

{% endblock %}
