<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}iBOX TV{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{% endblock %}">
    
    {% if canonical_url %}
    <link rel="canonical" href="{{ canonical_url }}">
    {% endif %}
    
    {% if meta_robots %}
    <meta name="robots" content="{{ meta_robots }}">
    {% endif %}

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YOUR_TAG_HERE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-YOUR_TAG_HERE');
    </script>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon-96x96.png') }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}" />
    <meta name="apple-mobile-web-app-title" content="iBOX TV" />
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}" />
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo-container">
                <a href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='logo.jpg') }}" alt="iBOX TV Logo" class="logo">
                </a>
            </div>
            
            <div class="nav-links">
                <a href="https://ibox-tv.com" class="nav-link {% if site_mode == 'tv' %}active{% endif %}">
                  <i class="fas fa-home"></i>
                  <span class="link-text {% if site_mode == 'anime' %}smart-reveal{% endif %}">TV Shows</span>
                </a>

                <a href="https://anime.ibox-tv.com" class="nav-link {% if site_mode == 'anime' %}active{% endif %}" style="color: #ff7675;">
                  <i class="fas fa-torii-gate"></i>
                  <span class="link-text {% if site_mode == 'tv' %}smart-reveal{% endif %}">Anime</span>
                </a>
                
                <a href="{{ url_for('list_shows') }}" class="nav-link">
                  <i class="fas fa-tv"></i><span class="link-text">Browse</span>
                </a>
                
                <span class="brand-text"><span class="ibox-text">iBOX</span><span class="tv-text">TV</span></span>
                
                <button type="button" class="search-icon-button" id="search-icon-btn" aria-label="Open Search">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        
        <div class="floating-search" id="floating-search-bar">
            <form action="{{ url_for('index') }}" method="GET">
                <input type="text" name="search" class="search-input" placeholder="Search..." value="{{ search_query if search_query else '' }}">
                <button type="submit" class="search-button"><i class="fas fa-search"></i></button>
            </form>
        </div>
    </nav>

    <div class="container">
        {% block content %}{% endblock %}
        
        <div id="custom-ad-container">
             <button id="hide-ads-btn" title="Hide Ads">Ã—</button>
             <div class="custom-ad-tile">
                 <span class="custom-ad-disclaimer">Sponsored</span>
                 Looking for a reliable way to make money online? 
                 <br>
                 <a href="https://t.me/ruffg_series_bot" target="_blank" class="custom-ad-link">Click here to start earning with Telegram!</a>
             </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             // 1. Mobile Search Toggle
             const searchBtn = document.getElementById('search-icon-btn');
             const searchBar = document.getElementById('floating-search-bar');
             
             searchBtn.addEventListener('click', (e) => {
                 e.stopPropagation();
                 searchBar.classList.toggle('active');
                 if(searchBar.classList.contains('active')) {
                     const input = searchBar.querySelector('input');
                     if(input) input.focus();
                 }
             });

             document.addEventListener('click', (e) => {
                 if (!searchBar.contains(e.target) && !searchBtn.contains(e.target)) {
                     searchBar.classList.remove('active');
                 }
             });

             // 2. Hide Custom Ads Logic
             const hideBtn = document.getElementById('hide-ads-btn');
             const adContainer = document.getElementById('custom-ad-container');
             
             if (hideBtn && adContainer) {
                 hideBtn.addEventListener('click', () => {
                     adContainer.style.display = 'none';
                 });
             }

             // 3. Slideshow Logic (Desktop & Mobile)
             const initSlideshow = (selector) => {
                 const container = document.querySelector(selector);
                 if (!container) return;

                 const slides = container.querySelectorAll('.mySlides');
                 if (slides.length === 0) return;

                 // Only run desktop auto-scroll logic if on desktop
                 if (selector === '.desktop-slideshow') {
                     let slideIndex = 0;
                     const showSlides = () => {
                        slides.forEach(slide => slide.classList.remove('active-slide'));
                        slideIndex++;
                        if (slideIndex > slides.length) { slideIndex = 1; }
                        
                        // Handle circular index for array access
                        slides[slideIndex - 1].classList.add('active-slide');
                        
                        // Center the active slide
                        const active = slides[slideIndex - 1];
                        const inner = container.querySelector('.slideshow-inner');
                        
                        // Calculate offset to center the active item
                        // Using simplistic calculation, typically requires precise widths
                        // but CSS flex centering handles most of it visually.
                        
                        setTimeout(showSlides, 3500);
                     };
                     showSlides();
                 }
                 
                 // Mobile logic is usually CSS scroll-snap, but if you added JS controls:
                 if (selector === '.mobile-slideshow') {
                     // Keep it simple for now, rely on CSS Scroll Snap
                 }
             };

             // Initialize
             initSlideshow('.desktop-slideshow');
        });
    </script>
</body>
</html>
