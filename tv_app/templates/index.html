{% extends "base.html" %}

{% block title %}TV Show Updates{% endblock %}

{% block content %}
    {% if message %}
        <div class="alert alert-warning" role="alert">
            {{ message }}
        </div>
    {% endif %}

    {% if not search_query %}
        <h2>Most Watched Today</h2>
        <div class="slideshow-container">
            <div class="slideshow-inner">
                {% for show in trending_shows %}
                    <div class="mySlides card">
                        <a href="{{ url_for('show_details', show_id=show.id) }}">
                            {% if show.poster_path %}
                                <img src="{{ show.poster_path }}" alt="{{ show.show_name }}">
                            {% else %}
                                <div class="telegram-loader"></div>
                            {% endif %}
                            <h2>{{ show.show_name }}</h2>
                            <p>{{ show.episode_title }}</p>
                        </a>
                    </div>
                {% endfor %}
            </div>

            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
            <a class="next" onclick="plusSlides(1)">&#10095;</a>
             <div class="dot-container">
                {% for show in trending_shows %}
                  <span class="dot" onclick="currentSlide({{ loop.index }})"></span>
                {% endfor %}
            </div>
        </div>
    {% endif %}


    {# --- Conditionally display either "Newly Added" or search results --- #}
    {% if not search_query %}
        <h2><span class="blinking-dot"></span>Newly Added</h2>
        <div class="tv-shows">
            {% for show in shows.items %}
                <div class="card">
                    <a href="{{ url_for('show_details', show_id=show.id) }}">
                        {% if show.poster_path %}
                            <img src="{{ show.poster_path }}" alt="{{ show.show_name }}" loading="lazy">
                        {% else %}
                        <div class="telegram-loader"></div>
                        {% endif %}
                        <h2>{{ show.show_name }}</h2>
                        <p>{{ show.episode_title }}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <h2>Search Results for "{{ search_query }}"</h2>
        <div class="tv-shows">
            {% if shows.items %}
                {% for show in shows.items %}
                    <div class="card">
                         <a href="{{ url_for('show_details', show_id=show.id) }}">
                            {% if show.poster_path %}
                                <img src="{{ show.poster_path }}" alt="{{ show.show_name }}" loading="lazy">
                            {% else %}
                             <div class="telegram-loader"></div>
                            {% endif %}
                            <h2>{{ show.show_name }}</h2>
                            <p>{{ show.episode_title }}</p>
                        </a>
                    </div>
                {% endfor %}
            {% else %}
                <p>No TV shows found.</p>
            {% endif %}
        </div>
    {% endif %}


     <div class="pagination">
        {% if shows.has_prev %}
        <a href="{{ url_for('index', page=shows.prev_num, search=search_query)
            }}">Previous</a>
        {% else %}
        <span class="disabled">Previous</span>
        {% endif %}

        {% for page_num in shows.iter_pages(left_edge=1, right_edge=1,
          left_current=2, right_current=2) %}
        {% if page_num %}
        {% if shows.page == page_num %}
        <span class="current-page">{{ page_num }}</span>
        {% else %}
        <a href="{{ url_for('index', page=page_num, search=search_query) }}">{{
            page_num }}</a>
        {% endif %}
        {% else %}
        <span class="ellipsis">â€¦</span>
        {% endif %}
        {% endfor %}

        {% if shows.has_next %}
        <a href="{{ url_for('index', page=shows.next_num, search=search_query)
            }}">Next</a>
        {% else %}
        <span class="disabled">Next</span>
        {% endif %}
    </div>

    {% if not search_query and shows.items %}
    <div></div>
    {% else %}
        {%if not shows.items%}
          <p>No TV shows found matching your query.</p>
        {%endif%}
    {% endif %}

{% endblock %}
