{% extends "base.html" %}

{# --- SEO Change: Updated Title --- #}
{% block title %}Search & Download Latest TV Shows{% endblock %}

{# --- SEO Change: Added Meta Description --- #}
{% block meta_description %}Your ultimate source for searching and downloading the latest TV shows and series. Explore trending shows and find download links easily on iBOX TV.{% endblock %}

{% block content %}
<div class="container-fluid"> {# Using container-fluid for potential full-width layout with sidebars #}
    <div class="row">

        <div class="col-lg-2 d-none d-lg-block text-center"> {# Adjust col-lg-X as needed #}
            <div style="position: sticky; top: 20px;"> {# Adjust top offset for sticky as needed #}
                <div id="ezoic-pub-ad-placeholder-107"></div>
                </div>
        </div>
        <div class="col-12 col-lg-8"> {# Takes up remaining width on large screens, full on smaller #}
            {% if message %}
                <div class="alert alert-warning" role="alert">
                    {{ message }}
                </div>
            {% endif %}

            {% if not search_query %}
            <h2><span class="eye-icon"></span>Most Watched Today</h2>
                <div class="slideshow-container">
                    <div class="desktop-slideshow">
                        <div class="slideshow-inner">
                        {% for show in trending_shows %}
                            <div class="mySlides slideshow-item">
                                <a href="{{ url_for('show_details', show_id=show.id) }}">
                                    {% if show.poster_path %}
                                        <img src="{{ show.poster_path }}" alt="{{ show.show_name }}" class="slideshow-image">
                                    {% else %}
                                        {# Consider adding a default placeholder image #}
                                        <div class="placeholder-image">No Poster</div>
                                    {% endif %}
                                    <div class="slide-caption">{{ show.show_name }}</div>
                                </a>
                            </div>
                        {% endfor %}
                        </div>
                    </div>
                    <div class="mobile-slideshow">
                        <div class="slideshow-inner">
                        {% for show in trending_shows %}
                            <div class="mySlides slideshow-item">
                                <a href="{{ url_for('show_details', show_id=show.id) }}">
                                    {% if show.poster_path %}
                                        <img src="{{ show.poster_path }}" alt="{{ show.show_name }}" class="slideshow-image">
                                    {% else %}
                                        {# Consider adding a default placeholder image #}
                                        <div class="placeholder-image">No Poster</div>
                                    {% endif %}
                                    <div class="slide-caption">{{ show.show_name }}</div>
                                </a>
                            </div>
                        {% endfor %}
                        </div>
                        <div class="slideshow-controls">
                            <button class="prev">&#10094;</button>
                            <button class="next">&#10095;</button>
                        </div>
                        <div class="slideshow-dots">
                            {# Dots will be generated by JavaScript #}
                        </div>
                    </div>
                </div>
            {% endif %}

            {# --- Conditionally display either "Newly Added" or search results --- #}
            {% if not search_query %}
                <h2><span class="new-icon"></span>Newly Added</h2>
                <div class="tv-shows">
                    {# Removed the "AD Placeholder as First Tile" block from here #}
                    {% for show in shows.items %}
                        <div class="show-card">
                            <a href="{{ url_for('show_details', show_id=show.id) }}">
                                {% if show.poster_path %}
                                <img src="{{ show.poster_path }}" alt="{{ show.show_name }}" loading="lazy">
                                {% else %}
                                    {# Consider adding a default placeholder image #}
                                    <div class="placeholder-image">No Poster</div>
                                {% endif %}
                                <h3>{{ show.show_name }}</h3>
                                <p class="episode-title">{{ show.episode_title }}</p>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <h2>Search Results for "{{ search_query }}"</h2>
                <div class="tv-shows">
                    {% if shows.items %}
                        {% for show in shows.items %}
                            <div class="show-card">
                                <a href="{{ url_for('show_details', show_id=show.id) }}">
                                    {% if show.poster_path %}
                                    <img src="{{ show.poster_path }}" alt="{{ show.show_name }}" loading="lazy">
                                    {% else %}
                                        {# Consider adding a default placeholder image #}
                                        <div class="placeholder-image">No Poster</div>
                                    {% endif %}
                                    <h3>{{ show.show_name }}</h3>
                                    <p class="episode-title">{{ show.episode_title }}</p>
                                </a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>No TV shows found matching "{{ search_query }}".</p> {# More specific message #}
                    {% endif %}
                </div>
            {% endif %}

            {# Pagination - Ensure search_query is passed correctly #}
            <div class="pagination">
            {% if shows.has_prev %}
                <a href="{{ url_for('index', page=shows.prev_num, search=request.args.get('search', '')) }}">Previous</a>
            {% else %}
                <span class="disabled">Previous</span>
            {% endif %}

            {% for page_num in shows.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                {% if page_num %}
                {% if shows.page == page_num %}
                    <span class="current-page">{{ page_num }}</span>
                {% else %}
                    <a href="{{ url_for('index', page=page_num, search=request.args.get('search', '')) }}">{{ page_num }}</a>
                {% endif %}
                {% else %}
                <span class="ellipsis">â€¦</span>
                {% endif %}
            {% endfor %}


            {% if shows.has_next %}
                <a href="{{ url_for('index', page=shows.next_num, search=request.args.get('search', '')) }}">Next</a>
            {% else %}
                <span class="disabled">Next</span>
            {% endif %}
            </div>

        </div>
        <div class="col-lg-2 d-none d-lg-block text-center"> {# Adjust col-lg-X as needed #}
            <div style="position: sticky; top: 20px;"> {# Adjust top offset for sticky as needed #}
                <div id="ezoic-pub-ad-placeholder-108"></div>
                </div>
        </div>
        </div>
</div>
{% endblock %}
